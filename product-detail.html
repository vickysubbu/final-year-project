<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Product Detail â€“ Farm Direct Connect</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { 
  background: linear-gradient(135deg, #e8f5e9, #ffeaa7, #fab1a0); 
  min-height: 100vh; 
  font-family: 'Poppins', sans-serif;
}
.main-card { 
  border-radius: 20px; 
  box-shadow: 0 10px 30px rgba(0,0,0,0.15); 
  overflow: hidden;
}
.product-img { 
  max-height: 550px; 
  object-fit: cover; 
  width: 100%; 
  border-radius: 20px 20px 0 0;
}
#gmap-iframe { 
  height: 450px; 
  width: 100%; 
  border-radius: 15px; 
  margin-top: 20px; 
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  border: none;
}
.payment-section { 
  background: #fff; 
  padding: 30px; 
  border-radius: 15px; 
  box-shadow: 0 5px 20px rgba(0,0,0,0.1); 
}
.price { 
  font-size: 2.4rem; 
  font-weight: bold; 
  color: #28a745; 
}
#google_translate_element { 
  position: fixed; 
  top: 10px; 
  right: 10px; 
  z-index: 1000; 
}
</style>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>

<div id="google_translate_element"></div>

<nav class="navbar navbar-light bg-white shadow-sm py-3">
  <div class="container">
    <a class="navbar-brand text-success fw-bold" href="consumer-dashboard.html">Back to Dashboard</a>
  </div>
</nav>

<main class="container my-5">
  <div class="main-card">
    <img id="product-img" class="product-img" src="https://via.placeholder.com/800x600" alt="Product">
    <div class="p-5">
      <h1 id="product-name" class="fw-bold">Loading...</h1>
      <p class="price" id="product-price">Loading...</p>
      <p class="lead" id="product-description">Loading...</p>
      <p><strong>Location:</strong> <span id="product-location">Loading...</span></p>
      <p><strong>Farmer:</strong> <span id="product-farmer">Loading...</span></p>

      <div class="payment-section mt-5">
        <h3>Complete Your Purchase</h3>
        <button class="btn btn-success btn-lg w-100" id="buy-btn">Pay with Razorpay</button>
      </div>
    </div>
  </div>
</main>

<script>
let currentProduct = null;

async function loadProduct() {
  const token = localStorage.getItem('token');
  const urlParams = new URLSearchParams(window.location.search);
  const id = urlParams.get('id');

  if (!id) {
    alert("No product ID found");
    window.location.href = "consumer-dashboard.html";
    return;
  }

  if (!token) {
    alert("Please login first");
    window.location.href = "login.html";
    return;
  }

  try {
    const res = await fetch(`http://localhost:5000/api/products/${id}`, {
      headers: { 'Authorization': `Bearer ${token}` }
    });

    const product = await res.json();

    if (!res.ok) {
      alert(product.msg || "Product not found");
      window.location.href = "consumer-dashboard.html";
      return;
    }

    currentProduct = product;

    document.getElementById('product-img').src = product.image || 'https://via.placeholder.com/800x600';
    document.getElementById('product-name').textContent = product.name;
    document.getElementById('product-price').textContent = product.price;
    document.getElementById('product-description').textContent = product.description || 'No description available';
    document.getElementById('product-location').textContent = product.location;
    document.getElementById('product-farmer').textContent = product.farmerName;

    document.getElementById('buy-btn').onclick = openPayment;
  } catch (err) {
    alert("Error loading product");
  }
}

function openPayment() {
  if (!currentProduct) return;

  const amountInRupees = parseFloat(currentProduct.price.replace(/[^\d.]/g, '')) || 100;
  const amountInPaise = Math.round(amountInRupees * 100);

  const options = {
    key: "rzp_test_1DP5mmOlF5G5ag",
    amount: amountInPaise,
    currency: "INR",
    name: "Farm Direct Connect",
    description: `Purchase: ${currentProduct.name}`,
    handler: function (response) {
      alert(`Payment Successful! ðŸŽ‰\nPayment ID: ${response.razorpay_payment_id}`);
    },
    prefill: {
      name: localStorage.getItem('username') || "Customer",
      contact: "9999999999",
      email: "customer@example.com"
    },
    theme: { color: "#28a745" },
    modal: { ondismiss: () => alert("Payment cancelled") }
  };

  const rzp = new Razorpay(options);
  rzp.open();
}

window.onload = loadProduct;
</script>

<script>
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'en',
    includedLanguages: 'en,ta,kn,ml,hi,te'
  }, 'google_translate_element');
}
</script>
<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

</body>
</html>