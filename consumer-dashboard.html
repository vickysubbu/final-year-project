<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consumer Dashboard â€“ Farm Direct Connect</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<style>
:root { 
  --green-main: #28a745; 
  --bg-gradient: linear-gradient(to bottom, #e8f5e9, #c8e6c9); 
}
body { 
  background: var(--bg-gradient); 
  min-height: 100vh; 
  font-family: 'Poppins', sans-serif;
}
.hero-header { 
  padding: 120px 20px; 
  background: linear-gradient(rgba(0,0,0,0.55), rgba(0,0,0,0.55)), 
              url('https://thumbs.dreamstime.com/b/vibrant-farmers-market-stall-fresh-organic-produce-colorful-abundant-display-fresh-organic-produce-local-399628245.jpg') center/cover; 
}
.product-card {
  border-radius: 18px; 
  box-shadow: 0 6px 20px rgba(0,0,0,0.12); 
  transition: transform 0.3s, box-shadow 0.3s;
  overflow: hidden;
}
.product-card:hover { 
  transform: translateY(-10px); 
  box-shadow: 0 15px 35px rgba(0,0,0,0.2); 
}
.product-card img { 
  height: 300px; 
  object-fit: cover; 
  border-top-left-radius: 18px; 
  border-top-right-radius: 18px; 
  transition: transform 0.5s; 
}
.product-card:hover img { 
  transform: scale(1.05); 
}
#product-list { 
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 1.5rem;
}
#google_translate_element { 
  position: fixed; 
  top: 10px; 
  right: 10px; 
  z-index: 1000; 
}
</style>
</head>
<body>

<div id="google_translate_element"></div>

<nav class="navbar navbar-light bg-white shadow-sm py-3">
  <div class="container">
    <a class="navbar-brand text-success fw-bold" href="index.html">Farm Direct Connect</a>
    <button class="btn btn-outline-danger" onclick="logout()">Logout</button>
  </div>
</nav>

<header class="hero-header text-center text-white">
  <h1 class="display-4 fw-bold">Fresh Farm Products Near You</h1>
  <p class="lead">Buy directly from local farmers</p>
</header>

<main class="container my-5">
  <div id="product-list" class="row"></div>
</main>

<script>
async function loadProducts() {
  const token = localStorage.getItem('token');
  const location = localStorage.getItem('userLocation') || 'Chennai';

  if (!token) {
    alert("Please login first");
    window.location.href = "login.html";
    return;
  }

  try {
    const res = await fetch(`http://localhost:5000/api/products?location=${location}`, {
      headers: { 'Authorization': `Bearer ${token}` }
    });

    if (!res.ok) throw new Error('Failed to load products');

    const products = await res.json();
    const container = document.getElementById('product-list');
    container.innerHTML = '';

    if (products.length === 0) {
      container.innerHTML = '<p class="text-center">No products available in your area</p>';
      return;
    }

    products.forEach(product => {
      const distText = product.distance ? Math.round(product.distance) + ' km' : 'Local';

      const card = document.createElement('div');
      card.className = 'col';
      card.innerHTML = `
        <div class="card product-card h-100">
          <img src="${product.image || 'https://via.placeholder.com/600x400'}" class="card-img-top" alt="${product.name}">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title fw-bold">${product.name}</h5>
            <p class="price text-success fw-bold fs-4">${product.price}</p>
            <p class="small text-muted mb-1">Farmer: ${product.farmerName}</p>
            <p class="small mb-2">
              <i class="bi bi-geo-alt-fill text-danger"></i> 
              ${product.location} 
              <span class="badge bg-success ms-2">${distText}</span>
            </p>
            <p class="text-muted small flex-grow-1">${product.description || 'Fresh from the farm'}</p>
            <a href="product-detail.html?id=${product._id}" class="btn btn-success mt-3">View Details</a>
          </div>
        </div>
      `;
      container.appendChild(card);
    });
  } catch (err) {
    console.error(err);
    document.getElementById('product-list').innerHTML = '<p class="text-center text-danger">Error loading products</p>';
  }
}

function logout() {
  if (confirm("Are you sure you want to logout?")) {
    localStorage.clear();
    window.location.href = "login.html";
  }
}

window.onload = loadProducts;
</script>

<script>
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'en',
    includedLanguages: 'en,ta,kn,ml,hi,te'
  }, 'google_translate_element');
}
</script>
<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>